<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <%- include('../partials/head')  %>
</head>
<body>
  
  <%- include('../partials/navbar', {user}) %>
  <div id="dashboard" class="container">
    <a href="/dashboard/user/add" class="btn btn-sm btn-success mb-1">add user</a>
    
    <!-- table -->
    <table class="table table-hover">
      <thead class="table-dark">
        <tr>
          <th scope="col">Id</th>
          <th scope="col">Name</th>
          <th scope="col">Email</th>
          <th scope="col">Gender</th>
          <th scope="col">Birth Day</th>
          <th scope="col">Banned</th>
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
  

  <script>
    const tbody = document.querySelector('tbody');
    
    fetch(`/api/v1/user`, {
      method: 'GET',
      headers: {'Content-Type': 'application/json'}
    })
    .then(data => data.json())
    .then(users => {
      users.forEach(user => {
        tbody.innerHTML += `
        <tr>
          <th scope="row">${user.id}</th>
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td>${user.gender}</td>
          <td>${user.birthday}</td>
          <td><button id="btn-delete" value="${user.id}" class="btn btn-sm btn-danger">banned</button></td>
        </tr>
        `;
      });
      
      const btnDelete = document.querySelectorAll('#btn-delete');
      btnDelete.forEach(btn => {
        btn.addEventListener('click', deleteUser)
      })
    })

    async function deleteUser() {
      const res = await fetch(`/api/v1/user/${this.value}`, {
        method: 'DELETE',
        headers: {'Content-Type': 'application/json'}
      })
      const data = res.json();
      if (data) {
        location.assign('/dashboard/user');
      }
    }
  </script>
</body>
</html>